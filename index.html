<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verdade ou Desafio - Jogo Completo</title>
    <style>
        /* --- ESTILOS GERAIS --- */
        body { font-family: 'Segoe UI', Tahoma, sans-serif; text-align: center; background-color: #2c3e50; color: white; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .hidden { display: none !important; } /* Classe m√°gica para esconder telas */
        
        /* --- BOT√ïES E INPUTS --- */
        button { padding: 12px 25px; font-size: 1.1em; border: none; border-radius: 50px; cursor: pointer; color: white; transition: 0.2s; font-weight: bold; margin: 5px; }
        button:active { transform: scale(0.95); }
        .btn-add { background: #27ae60; }
        .btn-start { background: #e67e22; width: 100%; margin-top: 20px; }
        .btn-spin { background: #8e44ad; font-size: 1.3em; padding: 15px 40px; margin-top: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn-verdade { background: #3498db; }
        .btn-desafio { background: #e74c3c; }
        .btn-voltar { background: #95a5a6; margin-top: 30px; }

        input { padding: 12px; border-radius: 8px; border: none; width: 60%; font-size: 1em; }
        
        /* --- TELA 1: LISTA DE JOGADORES --- */
        ul { list-style: none; padding: 0; }
        li { background: rgba(255,255,255,0.1); margin: 5px 0; padding: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        
        /* --- TELA 2: ROLETA --- */
        .roleta-container { position: relative; width: 300px; height: 300px; margin: 0 auto; }
        canvas { border-radius: 50%; box-shadow: 0 0 20px rgba(0,0,0,0.5); transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1); }
        .seta { 
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%); 
            width: 0; height: 0; 
            border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 30px solid white; 
            z-index: 10; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
        }

        /* --- TELA 3: PERGUNTA --- */
        .card { background: white; color: #333; padding: 30px; border-radius: 15px; margin-top: 20px; min-height: 150px; }
        .vez-de { font-size: 1.5em; color: #f1c40f; font-weight: bold; margin-bottom: 10px; text-shadow: 1px 1px 2px black; }
        .texto-pergunta { font-size: 1.3em; font-weight: bold; margin: 20px 0; }
        .tags { display: flex; justify-content: center; gap: 10px; font-size: 0.8em; margin-top: 10px; }
        .tag { padding: 5px 10px; border-radius: 10px; background: #eee; color: #555; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Verdade ou Desafio üé≤</h1>

        <div id="tela-cadastro">
            <h3>Quem vai jogar?</h3>
            <div>
                <input type="text" id="input-nome" placeholder="Nome do jogador..." onkeypress="handleEnter(event)">
                <button class="btn-add" onclick="adicionarJogador()">Adicionar</button>
            </div>
            <ul id="lista-jogadores">
                </ul>
            <button class="btn-start hidden" id="btn-iniciar" onclick="irParaRoleta()">INICIAR JOGO</button>
        </div>

        <div id="tela-roleta" class="hidden">
            <h3 id="msg-roleta">Gire a roleta!</h3>
            
            <div class="roleta-container">
                <div class="seta"></div>
                <canvas id="canvas-roleta" width="300" height="300"></canvas>
            </div>

            <button class="btn-spin" onclick="girarRoleta()">GIRAR</button>
        </div>

        <div id="tela-jogo" class="hidden">
            <div class="vez-de" id="nome-sorteado">Vez do Fulano</div>
            
            <div class="card">
                <div id="pergunta-texto" class="texto-pergunta">Escolha: Verdade ou Desafio?</div>
                <div id="info-area" class="tags" style="visibility: hidden;">
                    <span id="tag-nivel" class="tag">N√≠vel</span>
                    <span id="tag-categoria" class="tag">Categoria</span>
                </div>
            </div>

            <div class="botoes" id="area-escolha">
                <button class="btn-verdade" onclick="sortear('verdades')">VERDADE</button>
                <button class="btn-desafio" onclick="sortear('desafios')">DESAFIO</button>
            </div>

            <button class="btn-voltar hidden" id="btn-proxima-rodada" onclick="voltarParaRoleta()">Pr√≥xima Rodada ‚Üª</button>
        </div>

    </div>

    <script>
        // --- VARI√ÅVEIS DO JOGO ---
        let jogadores = [];
        let bancoDeDados = null;
        let anguloAtual = 0; // Para controlar a rota√ß√£o da roleta
        let ctx = null; // Contexto do Canvas

        // Cores para a roleta
        const cores = ["#E74C3C", "#3498DB", "#F1C40F", "#2ECC71", "#9B59B6", "#E67E22", "#1ABC9C"];

        // --- 1. L√ìGICA DE CADASTRO ---
        function handleEnter(e) {
            if (e.key === 'Enter') adicionarJogador();
        }

        function adicionarJogador() {
            const input = document.getElementById('input-nome');
            const nome = input.value.trim();

            if (nome) {
                jogadores.push(nome);
                atualizarLista();
                input.value = "";
                input.focus();
            }
        }

        function atualizarLista() {
            const lista = document.getElementById('lista-jogadores');
            lista.innerHTML = ""; // Limpa
            
            jogadores.forEach((nome, index) => {
                lista.innerHTML += `<li>${nome} <span style='cursor:pointer' onclick='removerJogador(${index})'>‚ùå</span></li>`;
            });

            // S√≥ mostra o bot√£o Iniciar se tiver 2 ou mais jogadores
            const btnIniciar = document.getElementById('btn-iniciar');
            if (jogadores.length >= 2) {
                btnIniciar.classList.remove('hidden');
            } else {
                btnIniciar.classList.add('hidden');
            }
        }

        function removerJogador(index) {
            jogadores.splice(index, 1);
            atualizarLista();
        }

        // --- 2. L√ìGICA DA ROLETA ---
        function irParaRoleta() {
            document.getElementById('tela-cadastro').classList.add('hidden');
            document.getElementById('tela-roleta').classList.remove('hidden');
            desenharRoleta();
        }

        function desenharRoleta() {
            const canvas = document.getElementById('canvas-roleta');
            ctx = canvas.getContext('2d');
            const centro = 150; // Metade de 300
            const raio = 150;
            const arco = (2 * Math.PI) / jogadores.length;

            ctx.clearRect(0, 0, 300, 300);

            for (let i = 0; i < jogadores.length; i++) {
                ctx.beginPath();
                ctx.fillStyle = cores[i % cores.length];
                ctx.moveTo(centro, centro);
                ctx.arc(centro, centro, raio, i * arco, (i + 1) * arco);
                ctx.fill();
                ctx.save();

                // Adicionar texto (nome)
                ctx.translate(centro, centro);
                ctx.rotate(i * arco + arco / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "white";
                ctx.font = "bold 16px Arial";
                ctx.fillText(jogadores[i], raio - 20, 5);
                ctx.restore();
            }
        }

        function girarRoleta() {
            const canvas = document.getElementById('canvas-roleta');
            const btnSpin = document.querySelector('.btn-spin');
            
            // Bloqueia bot√£o para n√£o clicar duas vezes
            btnSpin.disabled = true;
            btnSpin.style.opacity = 0.5;

            // Calcula um giro aleat√≥rio (entre 5 e 10 voltas completas + aleat√≥rio)
            const giroAleatorio = Math.floor(Math.random() * 360) + 3600; 
            anguloAtual += giroAleatorio;

            // Aplica o CSS Rotate
            canvas.style.transform = `rotate(${anguloAtual}deg)`;

            // Aguarda a anima√ß√£o acabar (4 segundos, definido no CSS)
            setTimeout(() => {
                calcularVencedor();
                btnSpin.disabled = false;
                btnSpin.style.opacity = 1;
            }, 4000);
        }

        function calcularVencedor() {
            // Matem√°tica para descobrir onde a seta parou
            // Como a seta est√° no topo (270 graus ou -90), precisamos ajustar
            const grausPorFatia = 360 / jogadores.length;
            
            // Normaliza o √¢ngulo atual para ficar entre 0 e 360
            const anguloEfetivo = anguloAtual % 360;
            
            // A seta aponta para cima. O canvas girou. Precisamos ver qual fatia est√° no topo.
            // A l√≥gica inversa √©: (360 - anguloEfetivo + offset da seta)
            // Offset da seta no topo √© 270deg em canvas padr√£o (0 √© direita)
            // Forma simplificada para rota√ß√£o CSS (0 √© topo):
            // O √¢ngulo aponta para o √≠ndice:
            const indiceVencedor = Math.floor(((360 - anguloEfetivo + 90) % 360) / grausPorFatia);
            
            // Nota: Se o c√°lculo ficar levemente deslocado, use Math.round ou ajuste o +90
            // Mas em CSS rotate, 0 √© topo? N√£o, padr√£o HTML 0 √© direita.
            // Ajuste visual: Se ficar errado, troque a l√≥gica do √≠ndice.
            // L√≥gica robusta: Indice = (Total - (Angulo % Total)) / Fatia
            
            // Vamos testar o indice invertido simples, costuma funcionar para CSS Rotate:
            const indice = Math.floor(((360 - (anguloAtual % 360)) / grausPorFatia)) % jogadores.length;

            const sorteado = jogadores[indice];
            irParaJogo(sorteado);
        }

        // --- 3. L√ìGICA DO JOGO (PERGUNTAS) ---
        function irParaJogo(nome) {
            document.getElementById('tela-roleta').classList.add('hidden');
            document.getElementById('tela-jogo').classList.remove('hidden');
            
            document.getElementById('nome-sorteado').innerText = `Vez de: ${nome}`;
            
            // Reseta a tela de pergunta
            document.getElementById('pergunta-texto').innerText = "Escolha: Verdade ou Desafio?";
            document.getElementById('info-area').style.visibility = "hidden";
            document.getElementById('area-escolha').classList.remove('hidden'); // Mostra bot√µes
            document.getElementById('btn-proxima-rodada').classList.add('hidden'); // Esconde bot√£o voltar
        }

        function sortear(tipo) {
            if (!bancoDeDados) return alert("Erro: Banco de dados n√£o carregou.");

            const lista = bancoDeDados[tipo];
            const item = lista[Math.floor(Math.random() * lista.length)];

            // Atualiza tela
            const texto = document.getElementById('pergunta-texto');
            texto.innerText = item.texto;

            document.getElementById('tag-nivel').innerText = item.nivel;
            document.getElementById('tag-categoria').innerText = item.categoria;
            document.getElementById('tag-nivel').className = "tag " + item.nivel;
            document.getElementById('info-area').style.visibility = "visible";

            // Esconde bot√µes de escolha e mostra o de voltar
            document.getElementById('area-escolha').classList.add('hidden');
            document.getElementById('btn-proxima-rodada').classList.remove('hidden');
        }

        function voltarParaRoleta() {
            document.getElementById('tela-jogo').classList.add('hidden');
            document.getElementById('tela-roleta').classList.remove('hidden');
            document.getElementById('msg-roleta').innerText = "Pr√≥ximo giro!";
        }

        // --- CARREGAMENTO DO JSON (IGUAL ANTES) ---
        async function carregarDados() {
            try {
                const res = await fetch('perguntas.json');
                const json = await res.json();
                bancoDeDados = json.conteudo;
            } catch (e) {
                console.error("Erro ao carregar JSON", e);
                alert("Use o Live Server para rodar este jogo!");
            }
        }

        window.onload = carregarDados;

    </script>
</body>
</html>